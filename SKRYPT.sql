CREATE TABLE klient (
    id_klienta               INTEGER NOT NULL,
    imie                     VARCHAR2(20) NOT NULL,
    nazwisko                 VARCHAR2(30) NOT NULL,
    ulica                    VARCHAR2(30) NOT NULL,
    numer_budynku            INTEGER NOT NULL,
    miasto                   VARCHAR2(40) NOT NULL,
    kod_pocztowy             INTEGER NOT NULL,
    numer_telefonu           VARCHAR2(9) NOT NULL,
    numer_pesel              VARCHAR2(11) NOT NULL,
    numer_karty_kredytowej   VARCHAR2(25) NOT NULL
);

ALTER TABLE klient ADD CONSTRAINT klient_pk PRIMARY KEY ( id_klienta );

CREATE TABLE pracownik (
    id_pracownika               INTEGER NOT NULL,
    imie_pracownika             VARCHAR2(20) NOT NULL,
    nazwisko_pracownika         VARCHAR2(30) NOT NULL,
    numer_telefonu_pracownika   VARCHAR2(9) NOT NULL,
    data_zatrudnienia           DATE NOT NULL,
    stanowisko                  VARCHAR2(20) NOT NULL
);

ALTER TABLE pracownik ADD CONSTRAINT pracownik_pk PRIMARY KEY ( id_pracownika );

CREATE TABLE rezerwacja (
    id_rezerwacji         INTEGER NOT NULL,
    kaucja                INTEGER NOT NULL,
    czy_kaucja_wplacona   VARCHAR2(3) NOT NULL,
    data_rezerwacji_od    DATE NOT NULL,
    data_rezerwacji_do    DATE NOT NULL,
    sprzet_id_sprzetu     INTEGER NOT NULL,
    klient_id_klienta     INTEGER NOT NULL
);

ALTER TABLE rezerwacja ADD CONSTRAINT rezerwacja_pk PRIMARY KEY ( id_rezerwacji );

CREATE TABLE sprzet (
    id_sprzetu       INTEGER NOT NULL,
    rodzaj_sprzetu   VARCHAR2(30) NOT NULL,
    marka            VARCHAR2(30) NOT NULL,
    status_sprzetu   VARCHAR2(15) NOT NULL,
    cena_za_dobe     INTEGER NOT NULL
);

ALTER TABLE sprzet ADD CONSTRAINT sprzet_pk PRIMARY KEY ( id_sprzetu );

CREATE TABLE wypozyczenie (
    id_wypozyczenia           INTEGER NOT NULL,
    sprzet_id_sprzetu         INTEGER NOT NULL,
    klient_id_klienta         INTEGER NOT NULL,
    pracownik_id_pracownika   INTEGER NOT NULL,
    data_wypozyczenia         DATE NOT NULL,
    data_oddania              DATE NOT NULL,
    cena                      INTEGER NOT NULL,
    czy_zaplacone             VARCHAR2(3) NOT NULL,
    ilosc_dni                 INTEGER NOT NULL,
    uwagi                     VARCHAR2(225),
    termin_zwrotu             DATE NOT NULL
);

ALTER TABLE wypozyczenie ADD CONSTRAINT wypozyczenie_pk PRIMARY KEY ( id_wypozyczenia );

ALTER TABLE rezerwacja
    ADD CONSTRAINT rezerwacja_klient_fk FOREIGN KEY ( klient_id_klienta )
        REFERENCES klient ( id_klienta );

ALTER TABLE rezerwacja
    ADD CONSTRAINT rezerwacja_sprzet_fk FOREIGN KEY ( sprzet_id_sprzetu )
        REFERENCES sprzet ( id_sprzetu );

ALTER TABLE wypozyczenie
    ADD CONSTRAINT wypozyczenie_klient_fk FOREIGN KEY ( klient_id_klienta )
        REFERENCES klient ( id_klienta );

ALTER TABLE wypozyczenie
    ADD CONSTRAINT wypozyczenie_pracownik_fk FOREIGN KEY ( pracownik_id_pracownika )
        REFERENCES pracownik ( id_pracownika );

ALTER TABLE wypozyczenie
    ADD CONSTRAINT wypozyczenie_sprzet_fk FOREIGN KEY ( sprzet_id_sprzetu )
        REFERENCES sprzet ( id_sprzetu );




INSERT INTO SPRZET(ID_SPRZETU, RODZAJ_SPRZETU, MARKA, STATUS_SPRZETU, CENA_ZA_DOBE) VALUES(1,'KOSIARKA','STIHL','USZKODZONE',30);
INSERT INTO SPRZET(ID_SPRZETU, RODZAJ_SPRZETU, MARKA, STATUS_SPRZETU, CENA_ZA_DOBE) VALUES(2,'SEKATOR','POLPLEX','DOBRY',20);
INSERT INTO SPRZET(ID_SPRZETU, RODZAJ_SPRZETU, MARKA, STATUS_SPRZETU, CENA_ZA_DOBE) VALUES(3,'NOZYCE_ELEKTRYCZNE','GARDENER','DOBRY',45);
INSERT INTO SPRZET(ID_SPRZETU, RODZAJ_SPRZETU, MARKA, STATUS_SPRZETU, CENA_ZA_DOBE) VALUES(4,'TRAKTOR','URSUS', 'AWARIA_SILNIKA',120);
INSERT INTO SPRZET(ID_SPRZETU, RODZAJ_SPRZETU, MARKA, STATUS_SPRZETU, CENA_ZA_DOBE) VALUES(5,'KOMBAJN','MERCEDES', 'DOBRY',250);

INSERT INTO PRACOWNIK(ID_PRACOWNIKA, IMIE_PRACOWNIKA, NAZWISKO_PRACOWNIKA, NUMER_TELEFONU_PRACOWNIKA, DATA_ZATRUDNIENIA, STANOWISKO) VALUES (1,'ANDRZEJ','NOWAK','678950465',DATE '2010-12-10','SPRZEDAWCA');
INSERT INTO PRACOWNIK(ID_PRACOWNIKA, IMIE_PRACOWNIKA, NAZWISKO_PRACOWNIKA, NUMER_TELEFONU_PRACOWNIKA, DATA_ZATRUDNIENIA, STANOWISKO) VALUES (2,'HANNA','TORBIEL','765294735',DATE '2009-05-04','KSIEGOWA');
INSERT INTO PRACOWNIK(ID_PRACOWNIKA, IMIE_PRACOWNIKA, NAZWISKO_PRACOWNIKA, NUMER_TELEFONU_PRACOWNIKA, DATA_ZATRUDNIENIA, STANOWISKO) VALUES (3,'WOJCIECH','BAK','623784198',DATE '2005-07-19','PREZES');
INSERT INTO PRACOWNIK(ID_PRACOWNIKA, IMIE_PRACOWNIKA, NAZWISKO_PRACOWNIKA, NUMER_TELEFONU_PRACOWNIKA, DATA_ZATRUDNIENIA, STANOWISKO) VALUES (4,'ALICJA','BACH','887357198',DATE'2013-11-30','SPRZEDAWCA');
INSERT INTO PRACOWNIK(ID_PRACOWNIKA, IMIE_PRACOWNIKA, NAZWISKO_PRACOWNIKA, NUMER_TELEFONU_PRACOWNIKA, DATA_ZATRUDNIENIA, STANOWISKO) VALUES (5,'ROMAN','MAKUCH','766839205',DATE'2011-10-25','MENAGER');

INSERT INTO KLIENT(ID_KLIENTA, IMIE, NAZWISKO, ULICA, NUMER_BUDYNKU, MIASTO, KOD_POCZTOWY, NUMER_TELEFONU, NUMER_PESEL, NUMER_KARTY_KREDYTOWEJ) VALUES(1,'NASH', 'GUTIERREZ','MILA',34,'BOSTON',22304,'739264902','11928549237','2227352037351237495012347');
INSERT INTO KLIENT(ID_KLIENTA, IMIE, NAZWISKO, ULICA, NUMER_BUDYNKU, MIASTO, KOD_POCZTOWY, NUMER_TELEFONU, NUMER_PESEL, NUMER_KARTY_KREDYTOWEJ) VALUES(2,'TANNER', 'BATES','PIEKNA',50,'CHICAGO',98255,'173958362','83625548921', '2227352037351237495012341');
INSERT INTO KLIENT(ID_KLIENTA, IMIE, NAZWISKO, ULICA, NUMER_BUDYNKU, MIASTO, KOD_POCZTOWY, NUMER_TELEFONU, NUMER_PESEL, NUMER_KARTY_KREDYTOWEJ) VALUES(3,'OREN','CAT','SLODKA',28,'LONDYN',22536,'987123645','99863521748', '2227352037351237495012343');
INSERT INTO KLIENT(ID_KLIENTA, IMIE, NAZWISKO, ULICA, NUMER_BUDYNKU, MIASTO, KOD_POCZTOWY, NUMER_TELEFONU, NUMER_PESEL, NUMER_KARTY_KREDYTOWEJ) VALUES(4,'PRESTON','AMSTRONG','DLUGA',1,'PARYZ',87123,'887453621','98342690103', '2227352037351237495012344');
INSERT INTO KLIENT(ID_KLIENTA, IMIE, NAZWISKO, ULICA, NUMER_BUDYNKU, MIASTO, KOD_POCZTOWY, NUMER_TELEFONU, NUMER_PESEL, NUMER_KARTY_KREDYTOWEJ) VALUES(5, 'CLARK','WOLF','KROTKA',14,'AMSTERDAM',34298,'776554987','00189348219', '2227352037351237495012348');

INSERT INTO REZERWACJA(ID_REZERWACJI, KAUCJA, CZY_KAUCJA_WPLACONA, DATA_REZERWACJI_OD, DATA_REZERWACJI_DO,SPRZET_ID_SPRZETU,KLIENT_ID_KLIENTA) VALUES(1,50,'TAK',DATE '2019-10-20',DATE '2019-10-30',1,2); 
INSERT INTO REZERWACJA(ID_REZERWACJI, KAUCJA, CZY_KAUCJA_WPLACONA, DATA_REZERWACJI_OD, DATA_REZERWACJI_DO,SPRZET_ID_SPRZETU,KLIENT_ID_KLIENTA) VALUES(2,30,'NIE',DATE '2019-10-10',DATE '2019-11-29',3,1); 
INSERT INTO REZERWACJA(ID_REZERWACJI, KAUCJA, CZY_KAUCJA_WPLACONA, DATA_REZERWACJI_OD, DATA_REZERWACJI_DO,SPRZET_ID_SPRZETU,KLIENT_ID_KLIENTA) VALUES(3,100,'TAK',DATE '2019-09-15',DATE '2019-10-03',4,3); 
INSERT INTO REZERWACJA(ID_REZERWACJI, KAUCJA, CZY_KAUCJA_WPLACONA, DATA_REZERWACJI_OD, DATA_REZERWACJI_DO,SPRZET_ID_SPRZETU,KLIENT_ID_KLIENTA) VALUES(4,140,'NIE',DATE '2019-06-01',DATE '2019-07-30',5,1); 
INSERT INTO REZERWACJA(ID_REZERWACJI, KAUCJA, CZY_KAUCJA_WPLACONA, DATA_REZERWACJI_OD, DATA_REZERWACJI_DO,SPRZET_ID_SPRZETU,KLIENT_ID_KLIENTA) VALUES(5,220,'TAK',DATE '2019-11-13',DATE '2019-11-25',4,5);

INSERT INTO WYPOZYCZENIE(ID_WYPOZYCZENIA, sprzet_id_sprzetu ,klient_id_klienta, pracownik_id_pracownika, data_wypozyczenia, data_oddania, CENA, CZY_ZAPLACONE, ILOSC_DNI, UWAGI, TERMIN_ZWROTU) VALUES(1,3,4,2, DATE '2019-10-21', DATE '2019-10-30',140,'TAK',9, 'SPRZET PRZYGOTOWANY', DATE '2019-11-01');
INSERT INTO WYPOZYCZENIE(ID_WYPOZYCZENIA, sprzet_id_sprzetu ,klient_id_klienta, pracownik_id_pracownika, data_wypozyczenia, data_oddania, CENA, CZY_ZAPLACONE, ILOSC_DNI, UWAGI, TERMIN_ZWROTU) VALUES(2,1,5,2, DATE '2019-10-11', DATE '2019-10-29',400,'NIE',15,'SPRZET Z DODATKOWYMI AKCESORIAKI',DATE '2019-10-30'); 
INSERT INTO WYPOZYCZENIE(ID_WYPOZYCZENIA, sprzet_id_sprzetu ,klient_id_klienta, pracownik_id_pracownika, data_wypozyczenia, data_oddania, CENA, CZY_ZAPLACONE, ILOSC_DNI, UWAGI, TERMIN_ZWROTU) VALUES(3,3,4,2, DATE '2019-09-15', DATE '2019-10-03',220,'TAK',18,'SPRZET Z DODATKOWYMI OSTRZAMI',DATE '2019-10-04'); 
INSERT INTO WYPOZYCZENIE(ID_WYPOZYCZENIA, sprzet_id_sprzetu ,klient_id_klienta, pracownik_id_pracownika, data_wypozyczenia, data_oddania, CENA, CZY_ZAPLACONE, ILOSC_DNI, UWAGI, TERMIN_ZWROTU) VALUES(4,5,1,3, DATE '2019-06-01', DATE '2019-07-30',360,'NIE',31,'SPRZET PRZYGOTOWANY',DATE '2019-08-02');
INSERT INTO WYPOZYCZENIE(ID_WYPOZYCZENIA, sprzet_id_sprzetu ,klient_id_klienta, pracownik_id_pracownika, data_wypozyczenia, data_oddania, CENA, CZY_ZAPLACONE, ILOSC_DNI, UWAGI, TERMIN_ZWROTU) VALUES(5,4,1,2, DATE '2019-10-21', DATE '2019-10-30',99,'TAK',20,'SPRZET PRZYGOTOWANY',DATE '2019-11-05');



SELECT CENA, CZY_ZAPLACONE FROM WYPOZYCZENIE WHERE CZY_ZAPLACONE LIKE 'TAK%';

SELECT IMIE, NAZWISKO FROM KLIENT WHERE ID_KLIENTA> 3;

SELECT * FROM WYPOZYCZENIE INNER JOIN REZERWACJA ON WYPOZYCZENIE.DATA_WYPOZYCZENIA = REZERWACJA.DATA_REZERWACJI_OD;

SELECT PRACOWNIK.IMIE_PRACOWNIKA,PRACOWNIK.STANOWISKO, WYPOZYCZENIE.DATA_WYPOZYCZENIA,WYPOZYCZENIE.DATA_ODDANIA,WYPOZYCZENIE.TERMIN_ZWROTU 
FROM PRACOWNIK INNER JOIN WYPOZYCZENIE ON PRACOWNIK.ID_PRACOWNIKA = WYPOZYCZENIE.ID_WYPOZYCZENIA AND PRACOWNIK.STANOWISKO LIKE '%SPRZEDAWCA';

SELECT KLIENT.IMIE, KLIENT.NAZWISKO,WYPOZYCZENIE.ILOSC_DNI, WYPOZYCZENIE.CENA, WYPOZYCZENIE.ILOSC_DNI*WYPOZYCZENIE.CENA FROM WYPOZYCZENIE LEFT OUTER JOIN KLIENT ON WYPOZYCZENIE.ID_WYPOZYCZENIA= KLIENT.ID_KLIENTA;




SELECT * FROM REZERWACJA;
UPDATE REZERWACJA
SET KAUCJA = 400
WHERE CZY_KAUCJA_WPLACONA = 'NIE';
SELECT * FROM REZERWACJA;

SELECT*FROM SPRZET;
UPDATE SPRZET SET STATUS_SPRZETU='W NAPRAWIE' 
WHERE CENA_ZA_DOBE>90 AND ID_SPRZETU >3;
SELECT*FROM SPRZET;

SELECT*FROM REZERWACJA;
UPDATE REZERWACJA
SET KAUCJA = 500
WHERE CZY_KAUCJA_WPLACONA = 'TAK';
SELECT*FROM REZERWACJA;

SELECT*FROM WYPOZYCZENIE;
UPDATE WYPOZYCZENIE SET CENA = CENA - CENA * ILOSC_DNI WHERE SPRZET_ID_SPRZETU > KLIENT_ID_KLIENTA;
SELECT*FROM WYPOZYCZENIE;
  
SELECT*FROM WYPOZYCZENIE;
UPDATE WYPOZYCZENIE SET CENA = CENA * ILOSC_DNI * 0.7;
SELECT STDDEV_POP(CENA)
FROM WYPOZYCZENIE;
SELECT*FROM WYPOZYCZENIE;


SELECT*FROM PRACOWNIK;
DELETE FROM PRACOWNIK
WHERE STANOWISKO = 'SPRZEDAWCA'
AND ID_PRACOWNIKA>1;
SELECT*FROM PRACOWNIK;

DELETE FROM REZERWACJA
WHERE DATA_REZERWACJI_DO
BETWEEN DATE '2019-10-10' AND DATE '2019-11-30';

SELECT*FROM WYPOZYCZENIE;
DELETE FROM WYPOZYCZENIE
WHERE ILOSC_DNI > '13' AND TERMIN_ZWROTU < DATE '2019-11-01' ;
SELECT*FROM WYPOZYCZENIE;

SELECT*FROM WYPOZYCZENIE;
DELETE FROM WYPOZYCZENIE
WHERE CENA IN (300, 200, 100, 882);
SELECT*FROM WYPOZYCZENIE;


SELECT*FROM WYPOZYCZENIE;
DELETE
FROM WYPOZYCZENIE
WHERE CENA<350;
DELETE
FROM REZERWACJA
WHERE KAUCJA <50;
COMMIT WORK;
SELECT*FROM WYPOZYCZENIE;


DROP TABLE REZERWACJA; 
DROP TABLE WYPOZYCZENIE; 
DROP TABLE KLIENT;
DROP TABLE PRACOWNIK;
DROP TABLE SPRZET;




